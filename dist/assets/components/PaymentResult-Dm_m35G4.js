import{r as s,j as e}from"../radix-core-Dr_t8bML.js";import{d as a,u as l}from"../routing-state-OoBjRc81.js";import{u as t,P as r,s as c,A as i,c as n,B as d}from"../index-CsVuzbQA.js";import{b as m,a9 as x,H as o,d as j,ac as h}from"../icons-animations-DmL7wN_q.js";import"../react-vendor-DHbHB7JU.js";import"../services-DyVQbO7m.js";import"../radix-extended-2duK1gdH.js";import"../utils-52VqQrbv.js";const u=()=>{var u,g;const[f]=a(),N=l(),[p,b]=s.useState(!0),[y,v]=s.useState(null),{user:w,updateProfile:I}=t(),k=f.get("paymentKey"),C=f.get("orderId"),P=f.get("amount"),S="true"===f.get("success");s.useEffect(()=>{if(!k||!C||!P)return v({success:!1,message:"잘못된 결제 정보입니다."}),void b(!1);S?_():q()},[k,C,P,S]);const _=async()=>{try{if(b(!0),await r.confirmPayment(k,C,parseInt(P)),w){const{data:s}=await c.from("user_profiles").select("*").eq("id",w.id).single();s&&await I(s)}v({success:!0,message:"결제가 성공적으로 완료되었습니다!",details:{orderId:C,amount:parseInt(P)}})}catch(s){v({success:!1,message:"결제 확인 중 오류가 발생했습니다. 고객센터에 문의해주세요.",details:{orderId:C,error:s.message}})}finally{b(!1)}},q=async()=>{try{const s=f.get("message")||"결제가 실패했습니다.";await c.from("payments").update({status:"failed",failed_reason:s}).eq("order_id",C),v({success:!1,message:s,details:{orderId:C}})}catch(s){v({success:!1,message:"결제 처리 중 오류가 발생했습니다.",details:{orderId:C}})}finally{b(!1)}},z=()=>{N("/")};return p?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(m,{className:"h-12 w-12 animate-spin mx-auto text-blue-500"}),e.jsx("h2",{className:"text-xl font-semibold",children:"결제 처리 중..."}),e.jsx("p",{className:"text-gray-600",children:"잠시만 기다려주세요."})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-8 text-center",children:(null==y?void 0:y.success)?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx(x,{className:"h-16 w-16 text-green-500 mx-auto"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"결제 완료!"}),e.jsx(i,{className:"mb-6 border-green-200 bg-green-50",children:e.jsx(n,{className:"text-green-800",children:y.message})}),y.details&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 text-left",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"결제 정보"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"주문번호:"}),e.jsx("span",{className:"font-mono",children:y.details.orderId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"결제금액:"}),e.jsxs("span",{className:"font-semibold",children:["₩",null==(u=y.details.amount)?void 0:u.toLocaleString()]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(d,{onClick:z,className:"w-full",size:"lg",children:[e.jsx(o,{className:"h-4 w-4 mr-2"}),"서비스 이용하기"]}),e.jsxs(d,{variant:"outline",onClick:()=>N("/account/billing"),className:"w-full",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"결제 내역 확인"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx(h,{className:"h-16 w-16 text-red-500 mx-auto"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"결제 실패"}),e.jsx(i,{className:"mb-6 border-red-200 bg-red-50",children:e.jsx(n,{className:"text-red-800",children:y.message})}),(null==(g=y.details)?void 0:g.orderId)&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 text-left",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"참조 정보"}),e.jsx("div",{className:"text-sm",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"주문번호:"}),e.jsx("span",{className:"font-mono",children:y.details.orderId})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(d,{onClick:()=>{N("/pricing")},className:"w-full",size:"lg",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"다시 결제하기"]}),e.jsxs(d,{variant:"outline",onClick:z,className:"w-full",children:[e.jsx(o,{className:"h-4 w-4 mr-2"}),"홈으로 돌아가기"]})]}),e.jsxs("div",{className:"mt-6 text-sm text-gray-500",children:[e.jsx("p",{children:"문제가 지속되면 고객센터에 문의해주세요."}),e.jsx("p",{children:"이메일: support@easypick.co.kr"})]})]})})})})};export{u as default};
