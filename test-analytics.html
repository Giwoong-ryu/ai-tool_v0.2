<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GA4 Analytics í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 3px; margin-top: 10px; white-space: pre-wrap; font-family: monospace; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ GA4 Analytics í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h3>ğŸ“Š ë¶„ì„ ì„œë¹„ìŠ¤ ìƒíƒœ</h3>
            <p>User ID: <span id="user-id">ë¡œë”©ì¤‘...</span></p>
            <p>Session ID: <span id="session-id">ë¡œë”©ì¤‘...</span></p>
            <div id="status-log" class="log"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ¨ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ í…ŒìŠ¤íŠ¸</h3>
            <button onclick="testTemplateSelect()">í…œí”Œë¦¿ ì„ íƒ ì´ë²¤íŠ¸</button>
            <button onclick="testPromptCompile()">í”„ë¡¬í”„íŠ¸ ì»´íŒŒì¼ ì´ë²¤íŠ¸</button>
            <div id="template-log" class="log"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ”„ ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸</h3>
            <button onclick="testWorkflowStart()">ì›Œí¬í”Œë¡œìš° ì‹œì‘</button>
            <button onclick="testWorkflowStep()">ë‹¨ê³„ ì™„ë£Œ</button>
            <div id="workflow-log" class="log"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ” ê¸°íƒ€ ì´ë²¤íŠ¸ í…ŒìŠ¤íŠ¸</h3>
            <button onclick="testToolInteraction()">AI ë„êµ¬ ìƒí˜¸ì‘ìš©</button>
            <button onclick="testSearch()">ê²€ìƒ‰ ì´ë²¤íŠ¸</button>
            <button onclick="testEngagement()">ì‚¬ìš©ì ì°¸ì—¬</button>
            <div id="misc-log" class="log"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“± ë°°ì¹˜ ì´ë²¤íŠ¸ í…ŒìŠ¤íŠ¸</h3>
            <button onclick="testBatchEvents()">ë°°ì¹˜ ì´ë²¤íŠ¸ ì „ì†¡</button>
            <div id="batch-log" class="log"></div>
        </div>
    </div>

    <script>
        // Mock Analytics Service (ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” import)
        class MockAnalyticsService {
            constructor() {
                this.userId = 'test_user_' + Math.random().toString(36).substr(2, 9);
                this.sessionId = 'test_session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                this.isInitialized = true;
                
                // Mock gtag
                window.gtag = window.gtag || function() {
                    console.log('GA4 gtag call:', arguments);
                };
            }

            async trackEvent(eventName, parameters = {}) {
                const eventData = {
                    event_name: eventName,
                    user_id: this.userId,
                    session_id: this.sessionId,
                    timestamp: new Date().toISOString(),
                    page_url: window.location.href,
                    page_title: document.title,
                    user_agent: navigator.userAgent,
                    ...parameters
                };

                try {
                    // Mock gtag call
                    if (window.gtag) {
                        const gtagParams = {
                            user_id: this.userId,
                            session_id: this.sessionId,
                            ...parameters
                        };
                        
                        window.gtag('event', eventName, gtagParams);
                        console.log('âœ… GA4 Event via gtag:', eventName, gtagParams);
                    }

                    // Mock Edge Function call
                    const response = await this.mockEdgeFunctionCall(eventData);
                    console.log('âœ… Edge Function Response:', response);

                    return { success: true, data: eventData };

                } catch (error) {
                    console.error('âŒ Analytics Error:', error);
                    return { success: false, error: error.message };
                }
            }

            async mockEdgeFunctionCall(eventData) {
                // Simulate Edge Function call
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve({
                            success: true,
                            processed: 1,
                            failed: 0,
                            event_name: eventData.event_name,
                            user_id: eventData.user_id,
                            session_id: eventData.session_id
                        });
                    }, 100 + Math.random() * 200);
                });
            }

            // EasyPick specific methods
            trackTemplateSelect(templateId, templateType, category) {
                return this.trackEvent('select_template', {
                    template_id: templateId,
                    template_type: templateType,
                    category: category,
                    event_category: 'prompt_tools',
                    event_label: `${templateType}_${category}`
                });
            }

            trackPromptCompile(promptId, promptLength, modelType, isSuccess = true) {
                return this.trackEvent('compile_prompt', {
                    prompt_id: promptId,
                    prompt_length: promptLength,
                    model_type: modelType,
                    success: isSuccess,
                    event_category: 'prompt_tools',
                    event_label: modelType,
                    value: promptLength
                });
            }

            trackWorkflowStart(workflowId, workflowType, stepCount) {
                return this.trackEvent('start_workflow', {
                    workflow_id: workflowId,
                    workflow_type: workflowType,
                    step_count: stepCount,
                    event_category: 'workflows',
                    event_label: workflowType,
                    value: stepCount
                });
            }

            trackWorkflowStep(workflowId, stepNumber, stepType, timeSpent) {
                return this.trackEvent('complete_step', {
                    workflow_id: workflowId,
                    step_number: stepNumber,
                    step_type: stepType,
                    time_spent: timeSpent,
                    event_category: 'workflows',
                    event_label: `${stepType}_step_${stepNumber}`,
                    value: timeSpent
                });
            }

            trackToolInteraction(toolId, toolName, actionType, category) {
                return this.trackEvent('tool_interaction', {
                    tool_id: toolId,
                    tool_name: toolName,
                    action_type: actionType,
                    category: category,
                    event_category: 'ai_tools',
                    event_label: `${actionType}_${toolName}`
                });
            }

            trackSearch(query, resultCount, filters = {}) {
                return this.trackEvent('search', {
                    search_term: query,
                    result_count: resultCount,
                    filters: JSON.stringify(filters),
                    event_category: 'search',
                    event_label: query
                });
            }

            trackEngagement(engagementType, duration, element) {
                return this.trackEvent('engagement', {
                    engagement_type: engagementType,
                    engagement_time: duration,
                    element: element,
                    event_category: 'engagement',
                    event_label: engagementType,
                    value: duration
                });
            }
        }

        // Initialize analytics
        const analytics = new MockAnalyticsService();

        // Update UI
        document.getElementById('user-id').textContent = analytics.userId;
        document.getElementById('session-id').textContent = analytics.sessionId;
        document.getElementById('status-log').textContent = 'âœ… Analytics Service ì´ˆê¸°í™” ì™„ë£Œ\nâœ… Session ID ìƒì„±ë¨\nâœ… í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ';

        // Test functions
        async function testTemplateSelect() {
            const log = document.getElementById('template-log');
            log.textContent = 'ğŸ”„ í…œí”Œë¦¿ ì„ íƒ ì´ë²¤íŠ¸ ì „ì†¡ ì¤‘...\n';
            
            const result = await analytics.trackTemplateSelect(
                'marketing_template_001',
                'marketing',
                'social_media'
            );
            
            log.textContent += result.success ? 
                'âœ… í…œí”Œë¦¿ ì„ íƒ ì´ë²¤íŠ¸ ì „ì†¡ ì„±ê³µ\n' + JSON.stringify(result.data, null, 2) :
                'âŒ ì‹¤íŒ¨: ' + result.error;
        }

        async function testPromptCompile() {
            const log = document.getElementById('template-log');
            log.textContent = 'ğŸ”„ í”„ë¡¬í”„íŠ¸ ì»´íŒŒì¼ ì´ë²¤íŠ¸ ì „ì†¡ ì¤‘...\n';
            
            const result = await analytics.trackPromptCompile(
                'prompt_001',
                256,
                'gpt-4',
                true
            );
            
            log.textContent += result.success ? 
                'âœ… í”„ë¡¬í”„íŠ¸ ì»´íŒŒì¼ ì´ë²¤íŠ¸ ì „ì†¡ ì„±ê³µ\n' + JSON.stringify(result.data, null, 2) :
                'âŒ ì‹¤íŒ¨: ' + result.error;
        }

        async function testWorkflowStart() {
            const log = document.getElementById('workflow-log');
            log.textContent = 'ğŸ”„ ì›Œí¬í”Œë¡œìš° ì‹œì‘ ì´ë²¤íŠ¸ ì „ì†¡ ì¤‘...\n';
            
            const result = await analytics.trackWorkflowStart(
                'content_creation_workflow',
                'content_creation',
                5
            );
            
            log.textContent += result.success ? 
                'âœ… ì›Œí¬í”Œë¡œìš° ì‹œì‘ ì´ë²¤íŠ¸ ì „ì†¡ ì„±ê³µ\n' + JSON.stringify(result.data, null, 2) :
                'âŒ ì‹¤íŒ¨: ' + result.error;
        }

        async function testWorkflowStep() {
            const log = document.getElementById('workflow-log');
            log.textContent = 'ğŸ”„ ì›Œí¬í”Œë¡œìš° ë‹¨ê³„ ì™„ë£Œ ì´ë²¤íŠ¸ ì „ì†¡ ì¤‘...\n';
            
            const result = await analytics.trackWorkflowStep(
                'content_creation_workflow',
                3,
                'content_generation',
                45000
            );
            
            log.textContent += result.success ? 
                'âœ… ì›Œí¬í”Œë¡œìš° ë‹¨ê³„ ì™„ë£Œ ì´ë²¤íŠ¸ ì „ì†¡ ì„±ê³µ\n' + JSON.stringify(result.data, null, 2) :
                'âŒ ì‹¤íŒ¨: ' + result.error;
        }

        async function testToolInteraction() {
            const log = document.getElementById('misc-log');
            log.textContent = 'ğŸ”„ AI ë„êµ¬ ìƒí˜¸ì‘ìš© ì´ë²¤íŠ¸ ì „ì†¡ ì¤‘...\n';
            
            const result = await analytics.trackToolInteraction(
                'chatgpt_001',
                'ChatGPT',
                'click',
                'text_generation'
            );
            
            log.textContent += result.success ? 
                'âœ… AI ë„êµ¬ ìƒí˜¸ì‘ìš© ì´ë²¤íŠ¸ ì „ì†¡ ì„±ê³µ\n' + JSON.stringify(result.data, null, 2) :
                'âŒ ì‹¤íŒ¨: ' + result.error;
        }

        async function testSearch() {
            const log = document.getElementById('misc-log');
            log.textContent = 'ğŸ”„ ê²€ìƒ‰ ì´ë²¤íŠ¸ ì „ì†¡ ì¤‘...\n';
            
            const result = await analytics.trackSearch(
                'AI ê¸€ì“°ê¸° ë„êµ¬',
                25,
                { category: 'writing', price: 'free' }
            );
            
            log.textContent += result.success ? 
                'âœ… ê²€ìƒ‰ ì´ë²¤íŠ¸ ì „ì†¡ ì„±ê³µ\n' + JSON.stringify(result.data, null, 2) :
                'âŒ ì‹¤íŒ¨: ' + result.error;
        }

        async function testEngagement() {
            const log = document.getElementById('misc-log');
            log.textContent = 'ğŸ”„ ì‚¬ìš©ì ì°¸ì—¬ ì´ë²¤íŠ¸ ì „ì†¡ ì¤‘...\n';
            
            const result = await analytics.trackEngagement(
                'scroll_depth',
                30000,
                'main_content'
            );
            
            log.textContent += result.success ? 
                'âœ… ì‚¬ìš©ì ì°¸ì—¬ ì´ë²¤íŠ¸ ì „ì†¡ ì„±ê³µ\n' + JSON.stringify(result.data, null, 2) :
                'âŒ ì‹¤íŒ¨: ' + result.error;
        }

        async function testBatchEvents() {
            const log = document.getElementById('batch-log');
            log.textContent = 'ğŸ”„ ë°°ì¹˜ ì´ë²¤íŠ¸ ì „ì†¡ ì¤‘...\n';
            
            try {
                // ì—¬ëŸ¬ ì´ë²¤íŠ¸ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì „ì†¡ (ì‹¤ì œ ë°°ì¹˜ëŠ” Edge Functionì—ì„œ ì²˜ë¦¬)
                const events = [
                    () => analytics.trackTemplateSelect('batch_template_1', 'email', 'newsletter'),
                    () => analytics.trackPromptCompile('batch_prompt_1', 180, 'gpt-3.5', true),
                    () => analytics.trackToolInteraction('midjourney_001', 'Midjourney', 'generate', 'image_generation')
                ];

                const results = await Promise.all(events.map(fn => fn()));
                
                const successCount = results.filter(r => r.success).length;
                const failCount = results.filter(r => !r.success).length;

                log.textContent += `âœ… ë°°ì¹˜ ì´ë²¤íŠ¸ ì „ì†¡ ì™„ë£Œ\nì„±ê³µ: ${successCount}, ì‹¤íŒ¨: ${failCount}\n\n`;
                
                results.forEach((result, index) => {
                    log.textContent += `ì´ë²¤íŠ¸ ${index + 1}: ${result.success ? 'âœ…' : 'âŒ'}\n`;
                });

            } catch (error) {
                log.textContent += 'âŒ ë°°ì¹˜ ì´ë²¤íŠ¸ ì „ì†¡ ì‹¤íŒ¨: ' + error.message;
            }
        }

        // Auto track page view
        window.addEventListener('load', () => {
            analytics.trackEvent('page_view', {
                page_name: 'analytics_test',
                page_title: 'GA4 Analytics í…ŒìŠ¤íŠ¸',
                event_category: 'navigation'
            });
        });
    </script>
</body>
</html>